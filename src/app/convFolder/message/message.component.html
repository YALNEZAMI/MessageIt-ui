<div class="main">
  <div
    class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12"
    style="padding: 0%"
  >
    <div class="card m-0">
      <!-- Row start -->
      <div id="convsMessagesRow" class="row no-gutters">
        <!-- side convs component -->
        <!-- <div class="users-container"> -->
        <app-conv-side></app-conv-side>
        <!-- </div> -->
        <div
          id="chatContainer"
          class="chat-container"
          #chatContainer
          (scroll)="checktop()"
          (scroll)="updateBottom()"
        >
          <div
            *ngIf="loading && MoreMessages && !isBottom"
            id="msgLoadingSpinner"
            class="spinner-border"
            role="status"
          >
            <span class="sr-only">Loading...</span>
          </div>
          <!--messages-->
          <div
            id="{{ msg._id }}"
            class="chat-box"
            *ngFor="let msg of getMessages()"
          >
            <div *ngIf="msg.lastMsgSeenBy != undefined">
              <div
                style="flex-direction: row-reverse"
                class="row"
                *ngFor="let viewerImg of msg.lastMsgSeenBy"
              >
                <img
                  style="width: 15px; height: 15px; margin-left: 5px"
                  src="{{ viewerImg.photo }}"
                  alt="dsc"
                />
              </div>
            </div>
            <div [ngClass]="getChatClasses(msg)">
              <div class="chat-avatar">
                <div class="center">
                  <img
                    src="{{ msg.sender.photo }}"
                    alt="{{ msg.sender.firstName }} {{ msg.sender.lastName }}"
                  />
                </div>

                <div class="chat-name">
                  {{ msg.sender.firstName }} {{ msg.sender.lastName }}
                </div>
                <div class="center msgSettings" (click)="delteOptions(msg)">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-gear-fill"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"
                    />
                  </svg>
                </div>
              </div>
              <div
                (click)="setMessageClicked(msg._id)"
                [ngClass]="textClasses(msg)"
                class="chat-text"
              >
                {{ msg.text }}
              </div>

              <div class="chat-hour" *ngIf="messageClicked == msg._id">
                {{ date(msg) }}
                <span class="fa fa-check-circle"></span>
              </div>
            </div>
          </div>
        </div>
        <!-- </div> -->
      </div>
      <!-- Row end -->
    </div>
  </div>

  <!--input elements group-->
  <div *ngIf="done" id="inputElementsGroup">
    <div
      *ngIf="!isBottom"
      [ngClass]="getInputSecondDivClasses()"
      id="InputSecondDiv"
    >
      <button
        (click)="appendDown()"
        id="downBtn"
        [ngClass]="{
          'btn':true,
          'btn-warning':true,
        }"
      >
        <svg
          *ngIf="!noMoreDown"
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-arrow-clockwise"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"
          />
          <path
            d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"
          />
        </svg>
        <svg
          *ngIf="noMoreDown"
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-arrow-down-circle"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"
          />
        </svg>
      </button>
    </div>
    <!--go to bottom btn-->

    <!--input component-->
    <app-input></app-input>
  </div>

  <div *ngIf="!done" class="d-flex align-items-center mySpinner">
    <strong>Loading...</strong>
    <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
  </div>
  <div (click)="delteOptions(null)" id="optionPopupCadre">
    <div id="optionPopup">
      <div
        *ngIf="canDeleteMsgForAll"
        (click)="deleteMsgForAll()"
        class="center btn btn-danger"
        id="deleteForAll"
      >
        Delete for all
      </div>
      <div
        (click)="deleteMsgForMe()"
        class="center btn btn-warning"
        id="deleteForMe"
      >
        Delete for me
      </div>
    </div>
  </div>
</div>
